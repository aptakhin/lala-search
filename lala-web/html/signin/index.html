<!DOCTYPE html>
<html lang="en">
<head>
    <!--#include virtual="/includes/head.html" -->
    <title>Sign In - LalaSearch</title>
    <script defer src="/js/signin.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body x-data="signInPage()" x-init="init()">
    <!--#include virtual="/includes/header.html" -->

    <div class="container">
        <div class="signin-box">
            <h2>Sign In to LalaSearch</h2>

            <!-- Before sending -->
            <div x-show="!sent">
                <label class="search-label">Your email address:</label>
                <div class="signin-input-group">
                    <input
                        type="email"
                        x-model="email"
                        @keydown.enter="requestLink()"
                        placeholder="you@example.com"
                        data-testid="signin-email-input"
                    >
                    <button @click="requestLink()" :disabled="sending" data-testid="signin-submit-button">
                        <span x-show="!sending">Send Sign-In Email</span>
                        <span x-show="sending">
                            <span class="spinner"></span> SENDING...
                        </span>
                    </button>
                </div>
                <div x-show="error" class="error" @click="error = null" style="cursor: pointer; margin-top: 10px;" data-testid="signin-error-message">
                    <strong>ERROR:</strong> <span x-text="error"></span>
                    <br><small>(Click to dismiss)</small>
                </div>
            </div>

            <!-- After sending -->
            <div x-show="sent" class="success-box" data-testid="signin-success-message">
                <p><strong>Check your email!</strong></p>
                <p style="margin-top: 10px;">We sent a sign-in link to <strong x-text="email"></strong>.</p>
                <p style="margin-top: 10px; font-size: 12px;">
                    The link expires in a few minutes. Check your spam folder if you don't see it.
                </p>
                <button @click="sent = false; email = ''" style="margin-top: 15px;">
                    Send Another Link
                </button>
            </div>
        </div>
    </div>

    <!--#include virtual="/includes/footer.html" -->

</body>
</html>
