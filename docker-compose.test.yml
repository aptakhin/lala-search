# SPDX-License-Identifier: BSD-3-Clause
# Copyright (c) 2026 Aleksandr Ptakhin
#
# Docker Compose Override for E2E Testing
# Usage: docker compose -f docker-compose.yml -f docker-compose.test.yml up

services:
  # Override agent with test environment
  lala-agent:
    environment:
      # Use test keyspace and index to avoid interfering with development data
      - CASSANDRA_KEYSPACE=lalasearch_test
      - MEILISEARCH_INDEX=documents_test
      # Mark as test agent in user agent string
      - USER_AGENT=LalaSearchBot/0.1 (E2E-Test)
      # Deployment mode: single_tenant by default; set DEPLOYMENT_MODE=multi_tenant
      # in the environment to run the multi-tenant test phase
      - DEPLOYMENT_MODE=${DEPLOYMENT_MODE:-single_tenant}
      # SMTP pass-through: Phase 1 sets SMTP_HOST= in the shell to disable
      # auth; Phase 2 sets SMTP_* to Mailtrap sandbox SMTP credentials.
      - SMTP_HOST=${SMTP_HOST:-}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USERNAME=${SMTP_USERNAME:-}
      - SMTP_PASSWORD=${SMTP_PASSWORD:-}
      - SMTP_TLS=${SMTP_TLS:-true}
      - SMTP_FROM_EMAIL=${SMTP_FROM_EMAIL:-noreply@test.e2e}
      - APP_BASE_URL=${APP_BASE_URL:-http://localhost:3000}
