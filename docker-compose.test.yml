# SPDX-License-Identifier: BSD-3-Clause
# Copyright (c) 2026 Aleksandr Ptakhin
#
# Docker Compose Override for E2E Testing
# Usage: docker compose -f docker-compose.yml -f docker-compose.test.yml up

services:
  # Override agent with test environment
  lala-agent:
    environment:
      # Use test keyspace and index to avoid interfering with development data
      - CASSANDRA_KEYSPACE=lalasearch_test
      - MEILISEARCH_INDEX=documents_test
      # Mark as test agent in user agent string
      - USER_AGENT=LalaSearchBot/0.1 (E2E-Test)
      # Deployment mode: single_tenant by default; set DEPLOYMENT_MODE=multi_tenant
      # in the environment to run the multi-tenant test phase
      - DEPLOYMENT_MODE=${DEPLOYMENT_MODE:-single_tenant}
      # SMTP override: maps MAILTRAP_SMTP_* from .env to the container's SMTP_* vars.
      # Phase 1 sets MAILTRAP_SMTP_HOST= in the shell to disable SMTP;
      # Phase 2 uses the Mailtrap credentials from .env as-is.
      - SMTP_HOST=${MAILTRAP_SMTP_HOST:-}
      - SMTP_PORT=${MAILTRAP_SMTP_PORT:-2525}
      - SMTP_USERNAME=${MAILTRAP_SMTP_USERNAME:-}
      - SMTP_PASSWORD=${MAILTRAP_SMTP_PASSWORD:-}
      - SMTP_TLS=true
      - SMTP_FROM_EMAIL=${SMTP_FROM_EMAIL:-noreply@test.e2e}
      - APP_BASE_URL=${APP_BASE_URL:-http://localhost:3000}
